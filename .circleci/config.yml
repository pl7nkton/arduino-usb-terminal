version: 2.1
orbs:
  android: circleci/android@2.1.2

jobs:
  android-test:
    executor:
      name: android/android-machine
      resource-class: large
      tag: 2022.12.1
    steps:
      - run: lsb_release -a
      - checkout
      - run: python3 scripts/generateKsPropFile.py
      - run: python3 scripts/generateGoogleServicesJson.py
      - run: sdkmanager --list
      - android/create-avd:
          avd-name: test
          install: true
          system-image: system-images;android-30;google_atd;x86
      - android/start-emulator:
          avd-name: test
      - android/run-tests

workflows:
  workflow:
    jobs:
      - android-test
